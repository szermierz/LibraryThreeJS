<!DOCTYPE html>
<html>
	<head>
		<title>The Library</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<canvas id="renderCanvas"></canvas>

		<!-- PdfJs -->
		<script src="pdf.js"></script>
		
		<!-- Grand father -->
		<script src="js/threejs/three.min.js"></script>
		<script src="js/threejs/TextGeometry.js"></script>
		<script src="js/threejs/FontUtils.js"></script>
		<script src="fonts/helvetiker.js"></script>
		
		<!-- Rendering -->
		<script src="js/core/rendering.js"></script>
		
		<!-- Events -->
		<script src="js/core/events.js"></script>
		
		<!-- Logic -->
		<script src="js/core/logic.js"></script>
		
		<script>
			
			// Setup PdfJs
			'use strict';
			
			// Setup library variables
			var g_HumanHeight = 1.0;
			var g_HumanPosX = 0.0;
			var g_HumanPosY = 0.0;
			var g_HumanPosZ = g_HumanHeight;
			var g_HumanDirectionAngle = 0.0;
			
			// Setup globals
			var g_ScreenWidth = window.innerWidth;
			var g_ScreenHeight = window.innerHeight;
			var g_RenderCanvas = document.getElementById("renderCanvas");
			g_RenderCanvas.width = g_ScreenWidth;
			g_RenderCanvas.height = g_ScreenHeight;
			var g_RenderContext = g_RenderCanvas.getContext("3d");
			var g_MainScene = new THREE.Scene();
			var g_LoadingScene = new THREE.Scene();
			var g_MainCamera = new THREE.PerspectiveCamera( 90, window.innerWidth/window.innerHeight, g_ScreenHeight / 4, g_ScreenHeight / 2 );
			var g_Renderer = new THREE.WebGLRenderer( { canvas: g_RenderCanvas } );
			var g_IsLoading = true;
			var g_ObjectToLoad = 0;
			
			console.log("Globals loaded!");
			
			// Setup main document
			g_MainCamera.position.z = g_ScreenHeight / 2;
			g_Renderer.setSize(g_ScreenWidth, g_ScreenHeight);
			document.body.appendChild(g_Renderer.domElement);
			
			console.log("Set up main document");
			
			// Setup pdf document
			PDFJS.workerSrc = 'pdf.worker.js';
			
			console.log("Set up pdf document");
			
			// Initialize loading
			var g_Loader = new PDFLoader();
			var l_LoadingBorder1 = new THREE.PlaneGeometry(310, 110);
			var l_LoadingMaterial1 = new THREE.MeshBasicMaterial( { color: 0x999999 } );
			var l_LoadingBox1 = new THREE.Mesh(l_LoadingBorder1, l_LoadingMaterial1);
			g_LoadingScene.add(l_LoadingBox1);
			var l_LoadingBorder2 = new THREE.PlaneGeometry(300, 100);
			var l_LoadingMaterial2 = new THREE.MeshBasicMaterial( { color: 0xBBBBBB } );
			var l_LoadingBox2 = new THREE.Mesh(l_LoadingBorder2, l_LoadingMaterial2);
			g_LoadingScene.add(l_LoadingBox2);
			var l_LoadingTextString = "Loading...";
			var l_LoadingTextGeo = new THREE.TextGeometry( l_LoadingTextString, { size: 50, height: 1, curveSegments: 2/*, font: "Courier New"*/ });
			var l_LoadingTextMaterial = new THREE.MeshBasicMaterial( { color: 0x000000 } );
			var l_LoadintText = new THREE.Mesh( l_LoadingTextGeo, l_LoadingTextMaterial );
			l_LoadintText.position.x = -140;
			l_LoadintText.position.y = -23;
			g_LoadingScene.add(l_LoadintText);
			
			console.log("Initialized display!");
			
			// Load resources:
			var l_FloorTexture; ++g_ObjectToLoad;
			g_Loader.LoadFloorTexture(function(texture) 
			{
				l_FloorTexture = texture;
				
				--g_ObjectToLoad;
			});
			
			console.log("Started loading resources!");
			
			//test
			g_Loader.LoadPDFTexture('test.pdf', 1, function(texture) 
			{
				var geo = new THREE.PlaneGeometry(100,100);
				var mat = new THREE.MeshBasicMaterial( {map: texture} );
				
				var mesh = new THREE.Mesh(geo, mat);
				
				g_MainScene.add(mesh);
			});
			//====
			
			var renderLoop = function () 
			{
				if(g_IsLoading == true && g_ObjectToLoad <= 0)
				{
					g_IsLoading = false;

					OnLoaded();
				}
				
				requestAnimationFrame(renderLoop);
			
				OnUpdate();
				
				if(g_IsLoading)
					g_Renderer.render(g_LoadingScene, g_MainCamera);
				else
					g_Renderer.render(g_MainScene, g_MainCamera);
			};

			renderLoop();
			
			
		</script>
		
	</body>
</html>